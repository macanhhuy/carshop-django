{% extends 'base.html' %}


{% block title %}check order{% endblock %}

{% block main %}
    <script>
    function changeQty(orderId, orderProductId, count){
        $.ajax({url:'/order/changeQty/' + orderId + '/' + orderProductId + '/' + count,
                type: 'post',
                success: function(data, status) {
                    if('error' == data){
                        alert('error');
                    }
                    else{
                        var dataObj=eval("("+data+")");
                        $('#total_' + orderId).text(parseFloat(dataObj.total).toFixed(2));
                        $('#qty_' + orderProductId)[0].value=dataObj.qty;
                    }
                },
                error: function(xhr, desc, err) {
                    alert(err + 'dddd');
                }
            });
    }


    </script>
    <table style="width:100%;">
    {% for order in orders %}
        <tr>
            <th align="left" colspan="2" style="width:360px;">No.:&nbsp;{{ order.pk }}</th>
            <th align="left" colspan="2" style="width:80px;"><span id="total_{{ order.pk }}">{{ order.order_total_price }}</span></th>
            <th ><input type="button" value="PAY NOW" class="pay_now"/></th>
        </tr>

        {% if order.order_products %}
        {% for order_product in order.order_products %}
        <tr>
            <td style="width:80px;"><img style="height:80px;width:80px;margin-right:30px;" src="/medias/images/{{ order_product.product_image }}" /></td>
            <td>{{ order_product.product_name }}</td>
            <td>{{ order_product.product_unit_price }}</td>
            <td ><a href="javascript:" onclick="changeQty('{{ order.pk }}', {{ order_product.pk }},'-1');">---</a>&nbsp;<input id="qty_{{ order_product.pk }}" type="text" value="{{ order_product.product_quantity }}" class="qty" readonly="readonly" />&nbsp;<a href="javascript:" onclick="changeQty('{{ order.id }}', {{ order_product.pk }}, '1');">+++</a></td>
            <td >remove</td>
        </tr>
        {% endfor %}
        {% endif %}
    {% endfor %}
    </table>
{% endblock %}
